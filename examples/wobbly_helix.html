<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="shortcut icon" href="../favicon.ico"/>
  <title>Explanarian - Helix</title>
  <script src="../src/lib/three.js"></script>
  <script src="../src/lib/CCapture.all.min.js"></script>
  <script src="../src/lib/socket.io.js"></script>
  <script src="../src/lib/OrbitControls.js"></script>
  <script src="../build/explanaria-bundle.js"></script>


  <link type="text/css" href="../src/style.css" rel="stylesheet" />

  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
</head>
<body>
  <script>
	var three = new Threeasy_Setup(true, 120,10);
	var controls = new THREE.OrbitControls(three.camera,three.renderer.domElement);

	three.camera.position.set(0,10,0);
	three.camera.lookAt(new THREE.Vector3(0,0,0));

	console.log("Loaded.");

	var helix = new EXP.Area({bounds: [[-5,5],[0,Math.PI]]});
	var transformation2 = new EXP.Transformation({'expr': (i,t,x,y) => [x,y,0]});
	var spin = new EXP.Transformation({'expr': (i,t,x,y,z) => [x*Math.cos(t*Math.PI),y*Math.sin(t*Math.PI),z]});
	var output2 = new EXP.LineOutput({width:5,color:0x0070f0});


	helix.add(transformation2).add(spin).add(output2)
	spin.add(new EXP.PointOutput({width:0.5,color:0x0070f0}));

	//tangent vectors
	var area = new EXP.Area({bounds: [[-5,5],[-Math.PI,Math.PI]],numPoints:30});
	var transformation = new EXP.Transformation({'expr': (i,t,x,y) => [x,y,0]});
	var spin2 = new EXP.Transformation({'expr': (i,t,x,y,z) => [x*Math.cos(t*Math.PI),y*Math.sin(t*Math.PI),z]});
	var output = new EXP.LineOutput({width:5});


	area.add(transformation).add(spin2).add(output)
	spin2.add(new EXP.PointOutput({width:0.2}));



	three.on("update",function(time){
		area.activate(time.t);
		helix.activate(time.t);
		//three.camera.position.set(10*Math.cos(time.t*Math.PI/10),10*Math.sin(time.t*Math.PI/10),0);
		//three.camera.rotation.y += -time.delta/Math.PI;
	});

	async function animate(){
		spin2.children[1].opacity = 0;
		output.opacity = 0;

		await delay(1000);

		TransitionTo(transformation2, {'expr': (i,t,u,v) => [Math.cos(u),Math.sin(u),u]})
		TransitionTo(transformation, {'expr': (i,t,u,v) => [Math.cos(u),Math.sin(u),u]})


		await delay(3000);

		output.opacity = 1;
		spin2.children[1].opacity = 1;

		TransitionTo(transformation, {'expr': (i,t,u,v) => [Math.cos(u) - v*Math.sin(u),Math.sin(u)+v*Math.cos(u),u]},2000)


		await delay(5000);	

		TransitionTo(three.camera.position, {x:10/Math.sqrt(2),y:10/Math.sqrt(2)});
		TransitionTo(three.camera.rotation, {y:Math.PI/4});

		TransitionTo(spin, {'expr': (i,t,x,y,z) => [x*Math.cos(t*Math.PI)+Math.sin(t*2+x)*Math.sin(z),y*Math.sin(t*Math.PI),Math.sin(t*3+x)*Math.sin(z)+z]},3000)
		TransitionTo(spin2, {'expr': (i,t,x,y,z) => [x*Math.cos(t*Math.PI)+Math.sin(t*3+x)*Math.sin(z),y*Math.sin(t*Math.PI),Math.sin(t*3+x)*Math.sin(z)+z]},3000)

	}
	animate();
  </script>
</body>
</html>
