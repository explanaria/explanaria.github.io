<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="shortcut icon" href="../favicon.ico"/>
  <title>Explanarian - Mobius transform</title>
  <script src="../src/lib/three.js"></script>
  <script src="../src/lib/socket.io.js"></script>
  <script src="../src/lib/OrbitControls.js"></script>
  <script src="../build/explanaria-bundle.js"></script>


  <link type="text/css" href="../src/style.css" rel="stylesheet" />

  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
</head>
<body>
  <script>
	var three = new Threeasy_Setup(true, 60,15);
	var controls = new THREE.OrbitControls(three.camera,three.renderer.domElement);

	three.camera.position.z = 4;

	console.log("Loaded.");

	var area = new EXP.Area({bounds: [[0.01,5],[0,2*Math.PI]]});
	var preCylindricalTranslation = new EXP.Transformation({'expr': function(i,t,r,theta){ let x = r*Math.cos(theta)-0,y=r*Math.sin(theta)-0;return [Math.sqrt(x*x+y*y),Math.atan2(y,x)]}}); //how ugly
	var transformation = new EXP.Transformation({'expr': (i,t,r,theta) => [r,theta,0]});
	var applyCylindricalCoords = new EXP.Transformation({'expr': (i,t,r,theta,z) => [r*Math.cos(theta),r*Math.sin(theta),z]});
	var postCartesianTransform = new EXP.Transformation({'expr': (i,t,x,y,z) => [x,y,z]});
	var output = new EXP.PointOutput({width:0.2});
	var output2 = new EXP.LineOutput({width:3});


	var unitcircle = new EXP.Area({bounds: [[0,2*Math.PI]], numItems: 40});
	unitcircle
		.add(new EXP.Transformation({'expr': (i,t,theta) => [1*Math.cos(theta),1*Math.sin(theta)]}))
		.add(new EXP.LineOutput({width:5, color: 0x000000}));

	/*
	var axis = new Area({bounds: [[-5,5]], numItems: 40});
	axis.add(new PointOutput({width:0.1, color: 0x000000}));

	var axis2 = new Area({bounds: [[0,0],[-5,5]], numItems: 40}); //this is a rather silly way to get a y-axis.
	axis2.add(new PointOutput({width:0.1, color: 0x000000}));*/

	area.add(preCylindricalTranslation)
		.add(transformation)
		.add(applyCylindricalCoords)
		.add(postCartesianTransform)
		.add(output);
	postCartesianTransform.add(output2); //also add the line

	three.on("update",function(time){
		area.activate(time.t);
		unitcircle.activate(time.t);
		//axis.activate(time.t);
		//axis2.activate(time.t);
		//controls.update();

		//three.camera.lookAt(new THREE.Vector3())
	});

	async function animate(){
		await delay(2000);

		//TransitionTo(preCylindricalTranslation, {'expr': function(i,t,r,theta){let x = r*Math.cos(theta)-1,y=r*Math.sin(theta)-0;return [Math.sqrt(x*x+y*y),Math.atan2(y,x)]}});
		await delay(2000);

		//to THE THIRD DIMENSION
		TransitionTo(three.camera.position, {'x':0,'y':-8,'z':2})
		TransitionTo(three.camera.rotation, {'x':1.325,'y':0,'z':0})

		await delay(1500);

		document.getElementById("label").style.opacity = 1;
		document.getElementById("label0").style.opacity = 0;

		//to the Riemann sphere!
		TransitionTo(transformation, {'expr': (i,t,r,theta) => [2*r/(r*r+1), theta, (r*r-1)/(r*r+1)]})
		await delay(2000);
		//and back again, completing the transformation
		TransitionTo(transformation, {'expr': (i,t,r,theta,z) => [1/r, theta, 0]})

		await delay(2000);
		TransitionTo(three.camera.position, {'x':0,'y':0,'z':4})
		TransitionTo(three.camera.rotation, {'x':0,'y':0,'z':0})

		await delay(2000);
		TransitionTo(postCartesianTransform, {'expr': (i,t,x,y,z) => [x+1,y,z]});
		document.getElementById("label2").style.opacity = 1;
		document.getElementById("label").style.opacity = 0;

		await delay(2000);

	}
	animate();
  </script>
	<div id="label0" class="exp-label">
		f(z) = z
	</div>
	<div id="label" class="exp-label" style="opacity: 0">
		f(z) = -1/z
	</div>
	<div id="label2" class="exp-label" style="opacity: 0">
		f(z) = -1/z + 1 = (z-1)/z
	</div>
	<div id="label3" class="exp-label" style="opacity: 0">
		f(z) = -1/z + 1
	</div>
</body>
</html>
